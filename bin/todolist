#! /usr/bin/env python

import thrift.protocol.TBinaryProtocol as TBinaryProtocol
import thrift.transport.THttpClient as THttpClient
import evernote.edam.userstore.UserStore as UserStore
import evernote.edam.notestore.NoteStore as NoteStore

from forget import todo

userStoreHttpClient = THttpClient.THttpClient("https://www.evernote.com/edam/user")
userStoreProtocol = TBinaryProtocol.TBinaryProtocol(userStoreHttpClient)
userStore = UserStore.Client(userStoreProtocol)

noteStoreUrl = userStore.getNoteStoreUrl(file("evernote.token").read())

noteStoreHttpClient = THttpClient.THttpClient(noteStoreUrl)
noteStoreProtocol = TBinaryProtocol.TBinaryProtocol(noteStoreHttpClient)
noteStore = NoteStore.Client(noteStoreProtocol)

list = todo.List(noteStore, file("evernote.token").read())
for note in list.tasks_by_expiration():
    print "  * ", note.title, " ( Expires: ", list.task_expiration_date(note), ")"



